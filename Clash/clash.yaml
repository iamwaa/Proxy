#==================== 基础设置 ====================#
port: 7890             # HTTP 代理端口
socks-port: 7891       # SOCKS5 端口
redir-port: 7892       # Redir 端口
mixed-port: 7893       # 混合端口
allow-lan: true        # 允许局域网访问
bind-address: "*"      # 监听所有地址
mode: rule             # 模式: rule / global / direct
log-level: info        # 日志等级
ipv6: false            # 关闭 IPv6（可按需开启）
external-controller: 127.0.0.1:9090
auto-update: true      # 自动更新订阅与规则（Clash Verge 专属）
update-interval: 86400 # 更新间隔

#==================== DNS 设置 ====================#
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "*.localhost"
    - "*.localdomain"
    - "*.example"
    - "*.invalid"
    - "*.test"
    - "localhost.ptlogin2.qq.com"
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.xboxlive.com"
    - "xbox.*.microsoft.com"
    - "*.battlenet.com.cn"
    - "*.battlenet.com"
    - "*.blzstatic.cn"
    - "*.battle.net"
    - "+.apple.com"
    - "+.icloud.com"
    - "time.*.com"
    - "time.*.apple.com"
  nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 223.5.5.5
    - 119.29.29.29
  default-nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 223.5.5.5
    - 119.29.29.29
  fallback:
    - https://1.1.1.1/dns-query
    - https://dns.google/dns-query
    - https://dns.alidns.com/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.twitter.com'

#==================== 锚点定义 ====================#
pr:   &a3 {type: select, proxies: [DIRECT, 香港节点, 台湾节点, 狮城节点, 日本节点, 美国节点, 自动选择, 手动切换]}
p:    &a1 {type: http, interval: 86400, health-check: {enable: true, url: http://www.gstatic.com/generate_204, interval: 1800}}
auto: &a4 {type: url-test, lazy: true, url: http://www.gstatic.com/generate_204, interval: 600, use: [Subscribe1, Subscribe2]}
use:  &a2 {type: select, use: [Subscribe1, Subscribe2]}
c:    &a6 {type: http, behavior: classical, interval: 86400}
d:    &a5 {type: http, behavior: domain, interval: 86400}
i:    &a7 {type: http, behavior: ipcidr, interval: 86400}

#==================== 代理订阅 ====================#
proxy-providers:
  Subscribe1:
    <<: *a1
    url: 
    path: ./proxy_providers/Subscribe1.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 600
  Subscribe2:
    <<: *a1
    url: 
    path: ./proxy_providers/Subscribe2.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 600

proxies: null

#==================== 策略分组 ====================#
proxy-groups:
  # 主分流组
  - {name: 全球加速, <<: *a3}
  - {name: 哔哩哔哩, type: select, proxies: [DIRECT, 香港节点, 台湾节点]}
  - {name: Apple, type: select, proxies: [DIRECT, 全球加速, 香港节点, 美国节点]}
  - {name: Google, type: select, proxies: [DIRECT, 全球加速, 香港节点, 美国节点]}
  - {name: AI, type: select, proxies: [DIRECT, AI节点, 美国节点]}
  - {name: AdBlock, type: select, proxies: [REJECT]}
  - {name: 兜底分流, type: select, proxies: [DIRECT, 全球加速]}

  # 节点分组
  - {name: "∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨ 节 点 分 组 ∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨ ∨", <<: *a2, filter: "流量|期|天"}
  - {name: 自动选择, <<: *a4}
  - {name: 手动切换, <<: *a2}
  - {name: 香港节点, <<: *a4, filter: "港|HK|(?i)(Hong)"}
  - {name: 台湾节点, <<: *a4, filter: "台|湾|TW|(?i)(Taiwan)"}
  - {name: 狮城节点, <<: *a4, filter: "新|坡|SG|(?i)(Singapore)"}
  - {name: 日本节点, <<: *a4, filter: "日|东京|JP|(?i)(Japan)"}
  - {name: 美国节点, <<: *a4, filter: "美|US|(?i)(States|American)"}
  - {name: AI节点,  <<: *a4, filter: "(?i)(gpt|openai|chatgpt|claude|gemini)"}
  - {name: Emby节点, <<: *a4, filter: "(?i)(emby)"}

#==================== 分流规则源 ====================#
rule-providers:
  Ad:          {<<: *a5, url: https://anti-ad.net/clash.yaml, path: ./ruleset/anti-ad-clash.yaml}
  AI:          {<<: *a6, url: https://proxy.lalifeier.eu.org/https://gist.githubusercontent.com/ddgksf2013/cb4121e8b5c5d865cc949cb8120320c4/raw/Ai.yaml, path: ./ruleset/AI.yaml}
  Apple:       {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple.yaml, path: ./ruleset/Apple.yaml}
  BiliBili:    {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.yaml, path: ./ruleset/BiliBili.yaml}
  ChinaIPs_IP: {<<: *a7, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaIPs/ChinaIPs_IP.yaml, path: ./ruleset/ChinaIPs_IP.yaml}
  Direct:      {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Direct/Direct.yaml, path: ./ruleset/Direct.yaml}
  Download:    {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Download/Download.yaml, path: ./ruleset/Download.yaml}
  GitHub:      {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml, path: ./ruleset/GitHub.yaml}
  Global:      {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Global/Global.yaml, path: ./ruleset/Global.yaml}
  Google:      {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml, path: ./ruleset/Google.yaml}
  Lan:         {<<: *a6, url: https://proxy.lalifeier.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml, path: ./ruleset/Lan.yaml}

#==================== 分流规则 ====================#
rules:
  - RULE-SET,Lan,DIRECT
  - RULE-SET,Download,DIRECT
  - RULE-SET,Ad,AdBlock
  - RULE-SET,AI,AI
  - RULE-SET,Apple,Apple
  - RULE-SET,BiliBili,哔哩哔哩
  - RULE-SET,GitHub,全球加速
  - RULE-SET,Google,Google
  - RULE-SET,Direct,DIRECT
  - RULE-SET,ChinaIPs_IP,DIRECT
  - GEOIP,CN,DIRECT
  - RULE-SET,Global,全球加速
  - MATCH,兜底分流
